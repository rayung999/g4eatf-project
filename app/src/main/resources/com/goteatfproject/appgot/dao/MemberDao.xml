<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goteatfproject.appgot.dao.MemberDao">

    <!-- 자바 객체의 프로퍼티와 컬럼 이름을 연결한다. -->
    <resultMap type="member" id="memberMap">
        <id column="mno" property="no"/>
        <result column="name" property="name"/>
        <result column="id" property="id"/>
        <result column="createddate" property="createdDate"/>
        <result column="nick" property="nick"/>
        <result column="birth" property="birth"/>
        <result column="intro" property="intro"/>
    </resultMap>


    <insert id="insert" useGeneratedKeys="true" parameterType="member">

        insert into member (id, pwd, name, nick, birth, tel, gender, createddate, post,
        addr, interest)
        values(#{id}, sha2(#{password},256), #{name}, #{nick}, #{birth}, #{tel}, #{gender}, now(),
        #{post}, #{address}, #{interest})


    </insert>

<!--    <select id="findByNo" resultMap="memberMap"> &lt;!&ndash;findbyno 회원상세정보 &ndash;&gt;-->
<!--        select-->
<!--        m.mno,-->
<!--        m.nick,-->
<!--        m.birth,-->
<!--        m.-->
<!--        from-->
<!--        app_member-->
<!--        where-->
<!--        mno=#{value}-->
<!--    </select>-->


    <select id="findAll" resultMap="memberMap">
        select
        mno,
        name,
        id      <!-- TODO email -> id 수정  -->
        from
        member
        order by
        mno
    </select>

    <select id="findByEmailPassword" resultMap="memberMap">
        select
        mno,
        name,
        id,
        createddate
        from
        member
        where
        id=#{id} and pwd=sha2(#{password},256)
    </select>


<!--  밑에서부턴 피드에서 필요해서 사용하는 쿼리  -->

    <!-- 랜덤 유저 리스트 조회 (팔로우 박스) -->
    <select id="userList" resultMap="memberMap">
        select
        mno,
        nick,
        intro,
        profile
        from member
        order by rand()
        Limit 20
    </select>

    <!--  회원 번호로 유저의 정보 조회  -->
    <select id="profileByNo" resultMap="memberMap">
        select
        mno,
        id,
        nick,
        birth,
        gender,
        interest,
        intro
        profile
        from member
        where mno=#{mno}
    </select>

    <!--  회원 이메일로 유저의 정보 조회  -->
    <select id="profileById" resultMap="memberMap">
        select
        mno,
        id,
        nick,
        birth,
        gender,
        interest,
        intro
        profile
        from member
        where id=#{id}
    </select>

</mapper>
